#kafka

##防止重复消费
防止重复消费有2中方式

1. 去掉消费者的自动提交,每处理完一条消息就手动commit一次
2. 在消费者这边做幂等操作

##消费者幂等操作
* 比如拿个数据要写库，你先根据主键查一下，如果这数据都有了，你就别插入了，update一下好
* 比如是写redis，那没问题了，反正每次都是set，天然幂等性
* 需要让生产者发送每条数据的时候，里面加一个全局唯一的id，类似订单id之类的东西，然后你这里消费到了之后，先根据这个id去比如redis里查一下，之前消费过吗？如果没有消费过，你就处理，然后这个id写redis。如果消费过了，那你就别处理了，保证别重复处理相同的消息即可。
* 基于数据库的唯一键来保证重复数据不会重复插入多条，重复数据拿到了以后我们插入的时候，因为有唯一键约束了，所以重复数据只会插入报错，不会导致数据库中出现脏数据
